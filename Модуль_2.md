# *demoexam 2026*
![image](https://github.com/Demomen-saveTF2/SA1-22demo2025/blob/main/topology.png)
## Задание 1

### Настройте контроллер домена Samba DC на сервере BR-SRV:

- Имя домена au-team.irpo

- Введите в созданный домен машину HQ-CLI

- Создайте 5 пользователей для офиса HQ: имена пользователей формата hquserNo (например hquser1, hquser2 и т.д.)

- Создайте группу hq, введите в группу созданных пользователей

- Убедитесь, что пользователи группы hq имеют право аутентифицироваться на HQ-CLI

- Пользователи группы hq должны иметь возможность повышать привилегии для выполнения ограниченного набора команд: cat, grep, id. Запускать другие команды с повышенными привилегиями пользователи группы права не имеют.


<br/>

<details>
<summary>Решение</summary>
<br/>



#### Настройка контроллерА домена Samba DC
```yml
apt-get update 
apt-get install task-samba-dc -y
```

Удаляем изначальную конфигурацию и интерактивно создаём домен командой **`samba-tool domain provision`** и просто несколько раз нажимаем `Enter`, а после вводим пароль **`P@ssw0rd`**
```yml
rm -rf /etc/samba/smb.conf
rm -rf /var/lib/samba
rm -rf /var/cache/samba
mkdir -p /var/lib/samba/sysvol
samba-tool domain provision
```

```yml
mv /etc/krb5.conf /etc/krb5.conf.back 
cp /var/lib/samba/private/krb5.conf /etc/krb5.conf
systemctl enable --now samba
systemctl restart network
systemctl restart samba.service 
```


Проверка:
```yml
samba-tool domain info 127.0.0.1
smbclient -L 127.0.0.1 -U administrator
```

Настроим DNS на BR-SRV:
```yml
samba-tool dns add br-srv.au-team.irpo au-team.irpo hq-srv A 192.168.1.10 -U Administrator
samba-tool dns add br-srv.au-team.irpo au-team.irpo hq-rtr A 192.168.1.1 -U Administrator
samba-tool dns add br-srv.au-team.irpo au-team.irpo br-rtr A 192.168.3.1 -U Administrator
samba-tool dns add br-srv.au-team.irpo au-team.irpo web.au-team.irpo A 172.16.1.1 -U Administrator
samba-tool dns add br-srv.au-team.irpo au-team.irpo docker.au-team.irpo A 172.16.2.1 -U Administrator
samba-tool dns query br-srv.au-team.irpo au-team.irpo @ ALL -U administrator
```

Создание группы и пользователей:
```yml
kinit administrator@AU-TEAM.IRPO
samba-tool group add hq
samba-tool group list

for i in {1..5}; 
do
  samba-tool user add hquser$i P@ssw0rd;
  samba-tool user setexpiry hquser$i --noexpiry;
  samba-tool group addmembers "hq" hquser$i;
  samba-tool user enable hquser$i;
done

samba-tool group listmembers hq
```

Меняем файл resolv.conf на BR-SRV:
```yml
echo "search au-team.irpo" > /etc/net/ifaces/ens18/resolv.conf
echo "nameserver 127.0.0.1" >> /etc/net/ifaces/ens18/resolv.conf
```


#### Переходим на HQ-CLI (работаем в графической оболочке)
Вручную меняем конфигурацию на статическую и задаем BR-SRV в качестве DNS-сервера.
Заходим в центр управления системой




Как только удастся зайти за доменного пользователя, переходим в терминал и работаем от root:

```yml
apt-get update && apt-get install libnss-role -y
```

```yml
control libnss-role
roleadd hq wheel
echo "WHEEL_USERS ALL=(ALL:ALL) /usr/bin/cat, /usr/bin/grep, /usr/bin/id" >> /etc/sudoers
tail /etc/sudoers
```

Перезагружаем и заходим доменным пользователем, выполняем sudo id, чтобы проверить появились ли права.

<br/>

</details>

<br/>
