# *demoexam 2026*
![image](https://github.com/Demomen-saveTF2/SA1-22demo2025/blob/main/topology.png)
## Задание 1

### Настройте контроллер домена Samba DC на сервере BR-SRV:

- Имя домена au-team.irpo

- Введите в созданный домен машину HQ-CLI

- Создайте 5 пользователей для офиса HQ: имена пользователей формата hquserNo (например hquser1, hquser2 и т.д.)

- Создайте группу hq, введите в группу созданных пользователей

- Убедитесь, что пользователи группы hq имеют право аутентифицироваться на HQ-CLI

- Пользователи группы hq должны иметь возможность повышать привилегии для выполнения ограниченного набора команд: cat, grep, id. Запускать другие команды с повышенными привилегиями пользователи группы права не имеют.

<br/>

<details>
<summary>Решение</summary>
<br/>

#### Настройка контроллера домена Samba DC
```yml
apt-get update 
apt-get install task-samba-dc -y
```
Удаляем изначальную конфигурацию и интерактивно создаём домен командой **`samba-tool domain provision`** и просто несколько раз нажимаем `Enter`, а после вводим пароль **`P@ssw0rd`**
```yml
rm -rf /etc/samba/smb.conf
rm -rf /var/lib/samba
rm -rf /var/cache/samba
mkdir -p /var/lib/samba/sysvol
samba-tool domain provision
```

```yml
mv /etc/krb5.conf /etc/krb5.conf.back 
cp /var/lib/samba/private/krb5.conf /etc/krb5.conf
systemctl enable --now samba
systemctl restart network
systemctl restart samba.service 
```

Проверка:
```yml
samba-tool domain info 127.0.0.1
smbclient -L 127.0.0.1 -U administrator
```

Настроим DNS на BR-SRV:
```yml
samba-tool dns add br-srv.au-team.irpo au-team.irpo hq-srv A 192.168.1.10 -U Administrator
samba-tool dns add br-srv.au-team.irpo au-team.irpo hq-rtr A 192.168.1.1 -U Administrator
samba-tool dns add br-srv.au-team.irpo au-team.irpo br-rtr A 192.168.3.1 -U Administrator
samba-tool dns add br-srv.au-team.irpo au-team.irpo web.au-team.irpo A 172.16.1.1 -U Administrator
samba-tool dns add br-srv.au-team.irpo au-team.irpo docker.au-team.irpo A 172.16.2.1 -U Administrator
samba-tool dns query br-srv.au-team.irpo au-team.irpo @ ALL -U administrator
```

Создание группы и пользователей:
```yml
kinit administrator@AU-TEAM.IRPO
samba-tool group add hq
samba-tool group list

for i in {1..5}; 
do
  samba-tool user add hquser$i P@ssw0rd;
  samba-tool user setexpiry hquser$i --noexpiry;
  samba-tool group addmembers "hq" hquser$i;
  samba-tool user enable hquser$i;
done

samba-tool group listmembers hq
```

Меняем файл resolv.conf на BR-SRV:
```yml
echo "search au-team.irpo" > /etc/net/ifaces/ens18/resolv.conf
echo "nameserver 127.0.0.1" >> /etc/net/ifaces/ens18/resolv.conf
```

#### Переходим на HQ-CLI (работаем в графической оболочке)
Вручную меняем конфигурацию на статическую и задаем BR-SRV в качестве DNS-сервера.
Заходим в центр управления системой

**(нужны скриншоты граф-оболочки и тд)**


Как только удастся зайти за доменного пользователя, переходим в терминал и работаем от root:

```yml
apt-get update && apt-get install libnss-role -y
```

```yml
control libnss-role
roleadd hq wheel
echo "WHEEL_USERS ALL=(ALL:ALL) /usr/bin/cat, /usr/bin/grep, /usr/bin/id" >> /etc/sudoers
tail /etc/sudoers
```

Перезагружаем и заходим доменным пользователем, выполняем sudo id, чтобы проверить появились ли права.

<br/>
</details>
<br/>


## Задание 2

### Сконфигурируйте файловое хранилище на сервере HQ-SRV:

- При помощи двух подключенных к серверу дополнительных дисков размером 1 Гб сконфигурируйте дисковый массив уровня 0

- Имя устройства – md0, при необходимости конфигурация массива размещается в файле /etc/mdadm.conf

- Создайте раздел, отформатируйте раздел, в качестве файловой системы используйте ext4

- Обеспечьте автоматическое монтирование в папку /raid


<br/>
<details>
<summary>Решение</summary>
<br/>



#### Настройка массива 

Находим названия тех дисков, что размером в 1 Гб, для этого введём команду `lsblk`. 
```yml
lsblk
```

Создание массива. Обратите внимание какого уровня массив нужно создать по вашему варианту. Для этого изменяем значение `--level=`. Если у вас несколько устройств - меняем уже значение `--raid-devices=`, после пишем путь к дискам через пробел `/dev/sdb1 /dev/sdc1`

```yml
mdadm --create /dev/md0 --level=0 --raid-devices=2 /dev/sdb1 /dev/sdc1
mdadm --detail --scan >> /etc/mdadm.conf
mkfs.ext4 /dev/md0
mkdir /raid
cp /etc/fstab /etc/fstab.back
echo "/dev/md0 /raid ext4 defaults 0 0	" >> /etc/fstab
mount -av
df -T
```

<br/>
</details>
<br/>

## Задание 3

### Настройте сервер сетевой файловой системы (nfs) на HQ-SRV:

- В качестве папки общего доступа выберите /raid/nfs, доступ для чтения и записи исключительно для сети в сторону HQ-CLI

- На HQ-CLI настройте автомонтирование в папку /mnt/nfs

- Основные параметры сервера отметьте в отчёте

<br/>

<details>
<summary>Решение</summary>
<br/>

#### Настройка общей папки 

```yml
apt-get update && apt-get install nfs-server nfs-utils -y
mkdir /raid/nfs
chmod 777 /raid/nfs
cp /etc/exports /etc/exports.back
echo "/raid/nfs 192.168.2.0/27(rw,no_subtree_check,no_root_squash)" >> /etc/exports
systemctl enable --now nfs-server
```

#### Переходим на HQ-CLI.

```yml
apt-get update && apt-get install nfs-utils nfs-clients -y
mkdir /mnt/nfs
chmod -R 777 /mnt/nfs
showmount -e hq-srv
cp /etc/fstab /etc/fstab.back
echo "192.168.0.10:/raid/nfs	/mnt/nfs	nfs	defaults	0	0" >> /etc/fstab
mount -av
df -T
```
> Обратите внимание на табы в файле `fstab`

<br/>
</details>
<br/>

## Задание 4

### Настройте службу сетевого времени на базе сервиса chrony на маршрутизаторе ISP:

- Вышестоящий сервер ntp на маршрутизаторе ISP - на выбор участника

- Стратум сервера - 5

- В качестве клиентов ntp настройте: HQ-SRV, HQ-CLI, BR-RTR, BR-SRV


<br/>
<details>
<summary>Решение</summary>
<br/>


#### Настройка службы сетевого времени ISP
```yml
sed -i 's/pool pool.ntp.org iburst/pool pool.ntp.org iburst prefer minstratum 4/' /etc/chrony.conf | grep pool /etc/chrony.conf
sed -i 's/\#local stratum 10/local stratum 5/' /etc/chrony.conf | grep "local stratum" /etc/chrony.conf
systemctl restart chronyd
```
#### Настройка клиентов:
#### На HQ-SRV, HQ-CLI
```yml
apt-get update && apt-get install chrony
echo "server 172.16.1.1 iburst" >> /etc/chrony.conf
systemctl restart chronyd
chronyc sources
```

#### На BR-SRV
```yml
apt-get update && apt-get install chrony
echo "server 172.16.2.1 iburst" >> /etc/chrony.conf
systemctl restart chronyd
chronyc sources
```

#### На HQ-RTR
```yml
conf
ntp server 172.16.1.1
end
wr mem
```

#### На BR-RTR
```yml
conf
ntp server 172.16.2.1
end
wr mem
```

<br/>
</details>
<br/>
